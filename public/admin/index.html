<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Certificar</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-logo">
            <h1>CertificarCursos</h1>
            <span class="admin-badge">ADMIN</span>
        </div>

        <nav class="sidebar-menu">
            <a class="menu-item active" onclick="showSection('dashboard')">
                <span class="menu-item-icon">üìä</span>
                Dashboard
            </a>
            <a class="menu-item" onclick="showSection('cursos')">
                <span class="menu-item-icon">üéì</span>
                Gest√£o de Cursos
            </a>
            <a class="menu-item" onclick="showSection('alunos')">
                <span class="menu-item-icon">üë•</span>
                Gest√£o de Alunos
            </a>
            <a class="menu-item" onclick="showSection('materiais')">
                <span class="menu-item-icon">üìö</span>
                Gest√£o de Materiais
            </a>
            <a class="menu-item" onclick="showSection('certificados')">
                <span class="menu-item-icon">üéì</span>
                Gest√£o de Certificados
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                <h2 id="pageTitle">Dashboard</h2>
            </div>
            <div class="header-actions">
                <a href="/" class="btn btn-secondary" style="margin-right: 10px;">‚Üê Voltar ao Site</a>
                <div class="admin-user">
                    <div class="admin-avatar">A</div>
                    <span id="adminName">Admin</span>
                </div>
                <button class="btn-logout" onclick="handleLogout()">Sair</button>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-card-header">
                            <div>
                                <h3>Total de Alunos</h3>
                                <div class="value" id="totalAlunos">0</div>
                            </div>
                            <div class="stat-card-icon">üë•</div>
                        </div>
                    </div>

                    <div class="stat-card orange">
                        <div class="stat-card-header">
                            <div>
                                <h3>Total de Materiais</h3>
                                <div class="value" id="totalMateriais">0</div>
                            </div>
                            <div class="stat-card-icon">üìö</div>
                        </div>
                    </div>

                    <div class="stat-card green">
                        <div class="stat-card-header">
                            <div>
                                <h3>Cursos Dispon√≠veis</h3>
                                <div class="value" id="totalCursos">0</div>
                            </div>
                            <div class="stat-card-icon">üéì</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Gest√£o de Cursos Section -->
            <section id="cursos" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>üéì Criar Novo Curso</h3>
                    </div>

                    <div id="cursoAlert" class="alert"></div>

                    <form onsubmit="criarCurso(event)">
                        <div class="form-group">
                            <label>T√≠tulo do Curso</label>
                            <input type="text" id="cursoTitulo" required placeholder="Ex: Curso de Assistente Administrativo">
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <textarea id="cursoDescricao" rows="3" required placeholder="Descri√ß√£o completa do curso"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Carga Hor√°ria</label>
                                <input type="text" id="cursoCargaHoraria" required placeholder="Ex: 40h">
                            </div>
                            <div class="form-group">
                                <label>Dura√ß√£o (meses)</label>
                                <input type="number" id="cursoDuracao" min="1" placeholder="Ex: 3">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Criar Curso</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Cursos Cadastrados</h3>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>T√≠tulo</th>
                                    <th>Carga Hor√°ria</th>
                                    <th>Dura√ß√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="cursosTable">
                                <tr>
                                    <td colspan="4" style="text-align: center;">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Gest√£o de Alunos Section -->
            <section id="alunos" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>üë• Autorizar Novo Aluno</h3>
                    </div>

                    <div id="alunoAlert" class="alert"></div>

                    <form onsubmit="autorizarAluno(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email do Aluno</label>
                                <input type="email" id="alunoEmail" required placeholder="aluno@exemplo.com">
                            </div>
                            <div class="form-group">
                                <label>Curso</label>
                                <select id="alunoCurso" required>
                                    <option value="">Selecione um curso</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Autorizar Aluno</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Alunos Autorizados</h3>
                    </div>

                    <div class="search-box">
                        <input type="text" id="searchAluno" placeholder="Buscar por email..." onkeyup="buscarAluno()">
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Curso</th>
                                    <th>C√≥digo</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="alunosTable">
                                <tr>
                                    <td colspan="6" style="text-align: center;">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Gest√£o de Materiais Section -->
            <section id="materiais" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>üìö Upload de Material</h3>
                    </div>

                    <div id="materialAlert" class="alert"></div>

                    <form onsubmit="uploadMaterial(event)">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">Arraste um arquivo ou clique para selecionar</div>
                            <div class="upload-hint">PDF, V√≠deo, Documentos (Max 100MB)</div>
                            <input type="file" id="materialFile" style="display: none;" required>
                        </div>

                        <div class="form-row" style="margin-top: 20px;">
                            <div class="form-group">
                                <label>Curso</label>
                                <select id="materialCurso" required>
                                    <option value="">Selecione um curso</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>M√≥dulo</label>
                                <input type="text" id="materialModulo" required placeholder="Ex: M√≥dulo 1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>T√≠tulo do Material</label>
                            <input type="text" id="materialTitulo" required placeholder="Ex: Introdu√ß√£o ao Curso">
                        </div>

                        <button type="submit" class="btn btn-success">Enviar Material</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Materiais Cadastrados</h3>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>T√≠tulo</th>
                                    <th>Curso</th>
                                    <th>M√≥dulo</th>
                                    <th>Tipo</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="materiaisTable">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Certificados Section -->
            <section id="certificados" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>üéì Emitir Certificado</h3>
                    </div>

                    <div id="certificadoAlert" class="alert"></div>

                    <form onsubmit="emitirCertificado(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Curso</label>
                                <select id="certificadoCurso" required onchange="loadAlunosPorCurso()">
                                    <option value="">Selecione um curso</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Aluno</label>
                                <select id="certificadoAluno" required>
                                    <option value="">Selecione um curso primeiro</option>
                                </select>
                            </div>
                        </div>

                        <div class="upload-area" id="uploadAreaCertificado">
                            <div class="upload-icon">üìú</div>
                            <div class="upload-text">Arraste o certificado ou clique para selecionar</div>
                            <div class="upload-hint">PDF do certificado (Max 10MB)</div>
                            <input type="file" id="certificadoFile" accept=".pdf" style="display: none;" required>
                        </div>

                        <button type="submit" class="btn btn-success" style="margin-top: 20px;">Emitir Certificado</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Certificados Emitidos</h3>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aluno</th>
                                    <th>Curso</th>
                                    <th>Data Emiss√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="certificadosTable">
                                <tr>
                                    <td colspan="4" style="text-align: center;">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (checkAuth()) {
                const session = JSON.parse(localStorage.getItem('admin_session'));
                document.getElementById('adminName').textContent = session.email.split('@')[0];
                startSessionTimer();
                loadDashboardData();
                loadCursosOptions();
                setupDragDrop();
                setupDragDropCertificado();
            }
        });
    </script>
</body>
</html>
